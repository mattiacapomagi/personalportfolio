import{g as ft}from"../chunks/BVJI5AyA.js";import{e as pt}from"../chunks/CBbuBPfZ.js";import{f as H,a as K}from"../chunks/Bn9cvOQ3.js";import{o as ht,a as gt}from"../chunks/CA4l-BPf.js";import{ad as mt,ae as G,af as wt,P as _t,d as t,Y as p,ag as $t,L as bt,a2 as Tt,a1 as _,a3 as $,a0 as E,am as Ct,$ as Q,an as It}from"../chunks/UO6eIlX8.js";import{d as Mt,s as N,e as U}from"../chunks/DxZHsUt4.js";import{i as Z}from"../chunks/BpMx89at.js";import{h as St}from"../chunks/BQjBlUda.js";import{r as kt,a as Pt}from"../chunks/B74C6Xdr.js";import{s as qt}from"../chunks/BhH5i77v.js";import{b as x}from"../chunks/B2yM3VP2.js";import{s as Et,a as yt}from"../chunks/BIK8TevO.js";import"../chunks/BET6sE6n.js";import{l as At}from"../chunks/DpI-_mNb.js";const Dt=!1;function Gt({params:r}){const i=ft(r.slug);if(!i)throw pt(404,"Tool not found");return{tool:i}}const ee=Object.freeze(Object.defineProperty({__proto__:null,load:Gt,ssr:Dt},Symbol.toStringTag,{value:"Module"})),Lt=(r,i,l,c,w)=>{r.fillStyle=`rgb(${w.r}, ${w.g}, ${w.b})`,r.fillRect(i,l,c,c);const a=Math.max(2,c*.15);r.fillStyle="rgba(255, 255, 255, 0.4)",r.beginPath(),r.moveTo(i,l),r.lineTo(i+c,l),r.lineTo(i+c-a,l+a),r.lineTo(i+a,l+a),r.fill(),r.beginPath(),r.moveTo(i,l),r.lineTo(i,l+c),r.lineTo(i+a,l+c-a),r.lineTo(i+a,l+a),r.fill(),r.fillStyle="rgba(0, 0, 0, 0.2)",r.beginPath(),r.moveTo(i+c,l),r.lineTo(i+c,l+c),r.lineTo(i+c-a,l+c-a),r.lineTo(i+c-a,l+a),r.fill(),r.beginPath(),r.moveTo(i,l+c),r.lineTo(i+c,l+c),r.lineTo(i+c-a,l+c-a),r.lineTo(i+a,l+c-a),r.fill()},j=(r,i)=>{const l=r.width,c=r.height,w=Math.ceil(l/i),a=Math.ceil(c/i),o=document.createElement("canvas");o.width=w,o.height=a;const d=o.getContext("2d",{willReadFrequently:!0});d.drawImage(r,0,0,w,a);const h=d.getImageData(0,0,w,a).data,g=[];for(let m=0;m<h.length;m+=4)h[m+3]<50?g.push(null):g.push({r:h[m],g:h[m+1],b:h[m+2]});return{columns:w,rows:a,data:g}},z=(r,i,l)=>{const{columns:c,rows:w,data:a}=i;for(let o=0;o<w;o++)for(let d=0;d<c;d++){const h=o*c+d,g=a[h];g&&Lt(r,d*l,o*l,l,g)}},Rt=(r,i,l)=>{const{columns:c,rows:w,data:a}=r,o=i/c,d=l/w;let h="";for(let g=0;g<w;g++)for(let m=0;m<c;m++){const u=g*c+m,y=a[u];if(y){const k=m*o,P=g*d,V=`rgb(${y.r},${y.g},${y.b})`;h+=`<rect x="${k}" y="${P}" width="${o}" height="${d}" fill="${V}" />`,h+=`<path d="M${k},${P} h${o} l-${o*.15},${d*.15} h-${o*.7} z" fill="white" fill-opacity="0.4" />`,h+=`<path d="M${k},${P} v${d} l${o*.15},-${d*.15} v-${d*.7} z" fill="white" fill-opacity="0.4" />`,h+=`<path d="M${k},${P+d} h${o} l-${o*.15},-${d*.15} h-${o*.7} z" fill="black" fill-opacity="0.2" />`,h+=`<path d="M${k+o},${P} v${d} l-${o*.15},-${d*.15} v-${d*.7} z" fill="black" fill-opacity="0.2" />`}}return`<svg width="${i}" height="${l}" viewBox="0 0 ${i} ${l}" xmlns="http://www.w3.org/2000/svg">
    <rect width="100%" height="100%" fill="transparent"/>
    ${h}
  </svg>`.trim()};var Bt=H('<div role="button" tabindex="0"><input type="file" class="hidden svelte-1otn1vq" accept="image/*,.tiff,.tif,.webp"/> <div class="upload-content svelte-1otn1vq"><h2 class="svelte-1otn1vq"> </h2> <p class="svelte-1otn1vq">JPG / PNG / GIF / WEBP / TIFF</p></div></div>'),Ot=H('<div class="processing-overlay svelte-1otn1vq"><div class="spinner svelte-1otn1vq"></div></div>'),Nt=H('<div class="workspace svelte-1otn1vq"><div class="workspace-content svelte-1otn1vq"><div class="canvas-container svelte-1otn1vq"><canvas class="svelte-1otn1vq"></canvas> <!></div> <div class="controls-panel svelte-1otn1vq"><div class="slider-section svelte-1otn1vq"><div class="slider-header svelte-1otn1vq"><span class="slider-label svelte-1otn1vq"> </span> <button class="reset-btn svelte-1otn1vq">RESET</button></div> <input type="range" min="0" max="100" class="svelte-1otn1vq"/></div> <div class="export-section svelte-1otn1vq"><button class="export-btn primary svelte-1otn1vq"> </button> <button class="export-btn secondary svelte-1otn1vq"> </button> <button class="export-btn new-image svelte-1otn1vq"> </button></div></div></div></div>'),Ft=H('<main class="bricklab-tool svelte-1otn1vq"><!></main>');function ne(r,i){mt(i,!0);const l=()=>yt(At,"$language",c),[c,w]=Et();let a=G(null),o=G(50),d=G(!1),h=G(!1),g=G(null),m=G(null),u=G(wt({past:[],present:50,future:[]})),y=It(()=>Math.round((50-t(o))/.35));_t(()=>{if(typeof window>"u"||!t(a)||!t(g))return;p(h,!0);const n=t(g).getContext("2d",{willReadFrequently:!0});if(!n)return;let e=t(a).width,s=t(a).height;const v=1500;if(e>v||s>v){const f=e/s;e>s?(e=v,s=v/f):(s=v,e=v*f)}e=Math.floor(e/t(o))*t(o),s=Math.floor(s/t(o))*t(o),t(g).width=e,t(g).height=s;const b=document.createElement("canvas");b.width=e,b.height=s,b.getContext("2d").drawImage(t(a),0,0,e,s);const C=j(b,t(o));n.clearRect(0,0,e,s),z(n,C,t(o)),p(h,!1)});function k(n){(n.metaKey||n.ctrlKey)&&n.key==="z"&&(n.preventDefault(),n.shiftKey?tt():V())}ht(()=>{window.addEventListener("keydown",k)}),gt(()=>{window.removeEventListener("keydown",k)});function P(){p(u,{past:[...t(u).past,t(u).present],present:t(o),future:[]},!0)}function V(){if(t(u).past.length===0)return;const n=t(u).past[t(u).past.length-1];p(u,{past:t(u).past.slice(0,-1),present:n,future:[t(u).present,...t(u).future]},!0),p(o,n,!0)}function tt(){if(t(u).future.length===0)return;const n=t(u).future[0];p(u,{past:[...t(u).past,t(u).present],present:n,future:t(u).future.slice(1)},!0),p(o,n,!0)}async function J(n){let e=n;if(n.type==="image/heic"||n.type==="image/heif"||n.name.toLowerCase().endsWith(".heic")){alert(l()==="en"?"HEIC files are not supported. Please use JPG/PNG.":"I file HEIC non sono supportati. Usa JPG/PNG.");return}const s=new Image;s.onload=()=>{p(a,s,!0)},s.onerror=()=>{alert(l()==="en"?"Invalid image format":"Formato immagine non valido")},s.src=URL.createObjectURL(e)}function et(n){var e,s;n.preventDefault(),p(d,!1),(s=(e=n.dataTransfer)==null?void 0:e.files)!=null&&s[0]&&J(n.dataTransfer.files[0])}function nt(n){var s;const e=n.target;(s=e.files)!=null&&s[0]&&J(e.files[0])}function at(n){const e=50-n*.35;p(o,Math.max(15,Math.min(50,e)),!0),p(u,{...t(u),present:t(o)},!0)}function ot(){P(),p(o,50),p(u,{...t(u),present:50},!0)}function st(){p(a,null),p(o,50),p(u,{past:[],present:50,future:[]},!0)}function rt(){if(!t(a))return;const n=Math.max(t(a).height,5e3);let e=t(a).width,s=t(a).height;const v=1500;if(e>v||s>v){const F=e/s;e>s?(e=v,s=v/F):(s=v,e=v*F)}const b=Math.floor(e/t(o)),I=Math.floor(s/t(o)),C=Math.floor(n/I),f=I*C,T=b*C,M=document.createElement("canvas");M.width=T,M.height=f,M.getContext("2d").drawImage(t(a),0,0,T,f);const A=j(M,C),S=document.createElement("canvas");S.width=T,S.height=f;const R=S.getContext("2d");z(R,A,C);const O=new Date,B=O.toISOString().split("T")[0],X=O.toTimeString().split(" ")[0].replace(/:/g,"."),q=document.createElement("a");q.download=`BRICKLAB ${B} ${X}.png`,q.href=S.toDataURL("image/png"),q.click()}function lt(){if(!t(a))return;let n=t(a).width,e=t(a).height;const s=1500;if(n>s||e>s){const S=n/e;n>e?(n=s,e=s/S):(e=s,n=s*S)}n=Math.floor(n/t(o))*t(o),e=Math.floor(e/t(o))*t(o);const v=document.createElement("canvas");v.width=n,v.height=e,v.getContext("2d").drawImage(t(a),0,0,n,e);const I=j(v,t(o)),C=Rt(I,n,e),f=new Blob([C],{type:"image/svg+xml"}),T=new Date,M=T.toISOString().split("T")[0],L=T.toTimeString().split(" ")[0].replace(/:/g,"."),A=document.createElement("a");A.download=`BRICKLAB ${M} ${L}.svg`,A.href=URL.createObjectURL(f),A.click()}var W=Ft();St("1otn1vq",n=>{bt(()=>{Tt.title="BRICKLAB — MATTIA CAPOMAGI"})});var it=_(W);{var ct=n=>{var e=Bt();let s;e.__click=()=>{var f;return(f=t(m))==null?void 0:f.click()},e.__keydown=f=>{var T;return f.key==="Enter"&&((T=t(m))==null?void 0:T.click())};var v=_(e);v.__change=nt,x(v,f=>p(m,f),()=>t(m));var b=E(v,2),I=_(b),C=_(I,!0);$(I),Ct(2),$(b),$(e),Q(()=>{s=qt(e,1,"upload-zone svelte-1otn1vq",null,s,{active:t(d)}),N(C,l()==="en"?"DROP / CLICK":"TRASCINA / CLICCA")}),U("dragenter",e,f=>{f.preventDefault(),p(d,!0)}),U("dragleave",e,f=>{f.preventDefault(),p(d,!1)}),U("dragover",e,f=>f.preventDefault()),U("drop",e,et),K(n,e)},vt=n=>{var e=Nt(),s=_(e),v=_(s),b=_(v);x(b,D=>p(g,D),()=>t(g));var I=E(b,2);{var C=D=>{var ut=Ot();K(D,ut)};Z(I,D=>{t(h)&&D(C)})}$(v);var f=E(v,2),T=_(f),M=_(T),L=_(M),A=_(L);$(L);var S=E(L,2);S.__click=ot,$(M);var R=E(M,2);kt(R),R.__pointerdown=P,R.__input=D=>at(parseInt(D.target.value)),$(T);var O=E(T,2),B=_(O);B.__click=rt;var X=_(B,!0);$(B);var q=E(B,2);q.__click=lt;var F=_(q,!0);$(q);var Y=E(q,2);Y.__click=st;var dt=_(Y,!0);$(Y),$(O),$(f),$(s),$(e),Q(()=>{N(A,`${l()==="en"?"BLOCK DENSITY":"DENSITÀ BLOCCHI"}: ${t(y)??""}`),Pt(R,t(y)),N(X,l()==="en"?"EXPORT PNG":"ESPORTA PNG"),N(F,l()==="en"?"EXPORT SVG":"ESPORTA SVG"),N(dt,l()==="en"?"NEW IMAGE":"NUOVA IMMAGINE")}),K(n,e)};Z(it,n=>{t(a)?n(vt,!1):n(ct)})}$(W),K(r,W),$t(),w()}Mt(["click","keydown","change","pointerdown","input"]);export{ne as component,ee as universal};
