import{g as ft}from"../chunks/BVJI5AyA.js";import{e as pt}from"../chunks/CBbuBPfZ.js";import{f as H,a as K}from"../chunks/C4KXQIWK.js";import{o as ht,a as gt}from"../chunks/vMEyNdyp.js";import{ad as mt,ae as G,af as wt,P as _t,d as t,X as p,ag as $t,L as bt,a2 as Tt,a1 as _,a3 as $,a0 as y,am as Ct,$ as Q,an as It}from"../chunks/Bct5q5Jl.js";import{d as Mt,s as B,e as U}from"../chunks/D5WjkzW7.js";import{i as Z}from"../chunks/B2laj_VG.js";import{h as St}from"../chunks/BoL__K91.js";import{r as kt,a as Pt}from"../chunks/2schDTMw.js";import{s as qt}from"../chunks/DJbM_1Dr.js";import{b as x}from"../chunks/BRhue5fj.js";import{s as Et,a as yt}from"../chunks/DbgeaQY9.js";import"../chunks/CereoTex.js";import{l as At}from"../chunks/GiQyGDmY.js";const Dt=!1;function Gt({params:r}){const i=ft(r.slug);if(!i)throw pt(404,"Tool not found");return{tool:i}}const ee=Object.freeze(Object.defineProperty({__proto__:null,load:Gt,ssr:Dt},Symbol.toStringTag,{value:"Module"})),Lt=(r,i,l,c,w)=>{r.fillStyle=`rgb(${w.r}, ${w.g}, ${w.b})`,r.fillRect(i,l,c,c);const o=Math.max(2,c*.15);r.fillStyle="rgba(255, 255, 255, 0.4)",r.beginPath(),r.moveTo(i,l),r.lineTo(i+c,l),r.lineTo(i+c-o,l+o),r.lineTo(i+o,l+o),r.fill(),r.beginPath(),r.moveTo(i,l),r.lineTo(i,l+c),r.lineTo(i+o,l+c-o),r.lineTo(i+o,l+o),r.fill(),r.fillStyle="rgba(0, 0, 0, 0.2)",r.beginPath(),r.moveTo(i+c,l),r.lineTo(i+c,l+c),r.lineTo(i+c-o,l+c-o),r.lineTo(i+c-o,l+o),r.fill(),r.beginPath(),r.moveTo(i,l+c),r.lineTo(i+c,l+c),r.lineTo(i+c-o,l+c-o),r.lineTo(i+o,l+c-o),r.fill()},Y=(r,i)=>{const l=r.width,c=r.height,w=Math.ceil(l/i),o=Math.ceil(c/i),s=document.createElement("canvas");s.width=w,s.height=o;const v=s.getContext("2d",{willReadFrequently:!0});v.drawImage(r,0,0,w,o);const h=v.getImageData(0,0,w,o).data,g=[];for(let m=0;m<h.length;m+=4)h[m+3]<50?g.push(null):g.push({r:h[m],g:h[m+1],b:h[m+2]});return{columns:w,rows:o,data:g}},z=(r,i,l)=>{const{columns:c,rows:w,data:o}=i;for(let s=0;s<w;s++)for(let v=0;v<c;v++){const h=s*c+v,g=o[h];g&&Lt(r,v*l,s*l,l,g)}},Rt=(r,i,l)=>{const{columns:c,rows:w,data:o}=r,s=i/c,v=l/w;let h="";for(let g=0;g<w;g++)for(let m=0;m<c;m++){const d=g*c+m,A=o[d];if(A){const P=m*s,q=g*v,V=`rgb(${A.r},${A.g},${A.b})`;h+=`<rect x="${P}" y="${q}" width="${s}" height="${v}" fill="${V}" />`,h+=`<path d="M${P},${q} h${s} l-${s*.15},${v*.15} h-${s*.7} z" fill="white" fill-opacity="0.4" />`,h+=`<path d="M${P},${q} v${v} l${s*.15},-${v*.15} v-${v*.7} z" fill="white" fill-opacity="0.4" />`,h+=`<path d="M${P},${q+v} h${s} l-${s*.15},-${v*.15} h-${s*.7} z" fill="black" fill-opacity="0.2" />`,h+=`<path d="M${P+s},${q} v${v} l-${s*.15},-${v*.15} v-${v*.7} z" fill="black" fill-opacity="0.2" />`}}return`<svg width="${i}" height="${l}" viewBox="0 0 ${i} ${l}" xmlns="http://www.w3.org/2000/svg">
    <rect width="100%" height="100%" fill="transparent"/>
    ${h}
  </svg>`.trim()};var Bt=H('<div role="button" tabindex="0"><input type="file" class="hidden svelte-1otn1vq" accept="image/*,.tiff,.tif,.webp"/> <div class="upload-content svelte-1otn1vq"><h2 class="svelte-1otn1vq"> </h2> <p class="svelte-1otn1vq">JPG / PNG / GIF / WEBP / TIFF</p></div></div>'),Ot=H('<div class="processing-overlay svelte-1otn1vq"><div class="spinner svelte-1otn1vq"></div></div>'),Nt=H('<div class="workspace svelte-1otn1vq"><button class="reset-image-btn svelte-1otn1vq"> </button> <div class="workspace-content svelte-1otn1vq"><div class="canvas-container svelte-1otn1vq"><canvas class="svelte-1otn1vq"></canvas> <!></div> <div class="controls-panel svelte-1otn1vq"><div class="slider-section svelte-1otn1vq"><div class="slider-header svelte-1otn1vq"><span class="slider-label svelte-1otn1vq"> </span> <button class="reset-btn svelte-1otn1vq">RESET</button></div> <input type="range" min="0" max="100" class="svelte-1otn1vq"/></div> <div class="export-section svelte-1otn1vq"><button class="export-btn primary svelte-1otn1vq"> </button> <button class="export-btn secondary svelte-1otn1vq"> </button></div></div></div></div>'),Ft=H('<main class="bricklab-tool svelte-1otn1vq"><!></main>');function ne(r,i){mt(i,!0);const l=()=>yt(At,"$language",c),[c,w]=Et();let o=G(null),s=G(50),v=G(!1),h=G(!1),g=G(null),m=G(null),d=G(wt({past:[],present:50,future:[]})),A=It(()=>Math.round((50-t(s))/.35));_t(()=>{if(typeof window>"u"||!t(o)||!t(g))return;p(h,!0);const n=t(g).getContext("2d",{willReadFrequently:!0});if(!n)return;let e=t(o).width,a=t(o).height;const u=1500;if(e>u||a>u){const f=e/a;e>a?(e=u,a=u/f):(a=u,e=u*f)}e=Math.floor(e/t(s))*t(s),a=Math.floor(a/t(s))*t(s),t(g).width=e,t(g).height=a;const b=document.createElement("canvas");b.width=e,b.height=a,b.getContext("2d").drawImage(t(o),0,0,e,a);const T=Y(b,t(s));n.clearRect(0,0,e,a),z(n,T,t(s)),p(h,!1)});function P(n){(n.metaKey||n.ctrlKey)&&n.key==="z"&&(n.preventDefault(),n.shiftKey?tt():V())}ht(()=>{window.addEventListener("keydown",P)}),gt(()=>{window.removeEventListener("keydown",P)});function q(){p(d,{past:[...t(d).past,t(d).present],present:t(s),future:[]},!0)}function V(){if(t(d).past.length===0)return;const n=t(d).past[t(d).past.length-1];p(d,{past:t(d).past.slice(0,-1),present:n,future:[t(d).present,...t(d).future]},!0),p(s,n,!0)}function tt(){if(t(d).future.length===0)return;const n=t(d).future[0];p(d,{past:[...t(d).past,t(d).present],present:n,future:t(d).future.slice(1)},!0),p(s,n,!0)}async function J(n){let e=n;if(n.type==="image/heic"||n.type==="image/heif"||n.name.toLowerCase().endsWith(".heic")){alert(l()==="en"?"HEIC files are not supported. Please use JPG/PNG.":"I file HEIC non sono supportati. Usa JPG/PNG.");return}const a=new Image;a.onload=()=>{p(o,a,!0)},a.onerror=()=>{alert(l()==="en"?"Invalid image format":"Formato immagine non valido")},a.src=URL.createObjectURL(e)}function et(n){var e,a;n.preventDefault(),p(v,!1),(a=(e=n.dataTransfer)==null?void 0:e.files)!=null&&a[0]&&J(n.dataTransfer.files[0])}function nt(n){var a;const e=n.target;(a=e.files)!=null&&a[0]&&J(e.files[0])}function at(n){const e=50-n*.35;p(s,Math.max(15,Math.min(50,e)),!0),p(d,{...t(d),present:t(s)},!0)}function ot(){q(),p(s,50),p(d,{...t(d),present:50},!0)}function st(){p(o,null),p(s,50),p(d,{past:[],present:50,future:[]},!0)}function rt(){if(!t(o))return;const n=Math.max(t(o).height,5e3);let e=t(o).width,a=t(o).height;const u=1500;if(e>u||a>u){const F=e/a;e>a?(e=u,a=u/F):(a=u,e=u*F)}const b=Math.floor(e/t(s)),C=Math.floor(a/t(s)),T=Math.floor(n/C),f=C*T,I=b*T,S=document.createElement("canvas");S.width=I,S.height=f,S.getContext("2d").drawImage(t(o),0,0,I,f);const k=Y(S,T),M=document.createElement("canvas");M.width=I,M.height=f;const W=M.getContext("2d");z(W,k,T);const O=new Date,R=O.toISOString().split("T")[0],N=O.toTimeString().split(" ")[0].replace(/:/g,"."),E=document.createElement("a");E.download=`BRICKLAB ${R} ${N}.png`,E.href=M.toDataURL("image/png"),E.click()}function lt(){if(!t(o))return;let n=t(o).width,e=t(o).height;const a=1500;if(n>a||e>a){const M=n/e;n>e?(n=a,e=a/M):(e=a,n=a*M)}n=Math.floor(n/t(s))*t(s),e=Math.floor(e/t(s))*t(s);const u=document.createElement("canvas");u.width=n,u.height=e,u.getContext("2d").drawImage(t(o),0,0,n,e);const C=Y(u,t(s)),T=Rt(C,n,e),f=new Blob([T],{type:"image/svg+xml"}),I=new Date,S=I.toISOString().split("T")[0],L=I.toTimeString().split(" ")[0].replace(/:/g,"."),k=document.createElement("a");k.download=`BRICKLAB ${S} ${L}.svg`,k.href=URL.createObjectURL(f),k.click()}var X=Ft();St("1otn1vq",n=>{bt(()=>{Tt.title="BRICKLAB — MATTIA CAPOMAGI"})});var it=_(X);{var ct=n=>{var e=Bt();let a;e.__click=()=>{var f;return(f=t(m))==null?void 0:f.click()},e.__keydown=f=>{var I;return f.key==="Enter"&&((I=t(m))==null?void 0:I.click())};var u=_(e);u.__change=nt,x(u,f=>p(m,f),()=>t(m));var b=y(u,2),C=_(b),T=_(C,!0);$(C),Ct(2),$(b),$(e),Q(()=>{a=qt(e,1,"upload-zone svelte-1otn1vq",null,a,{active:t(v)}),B(T,l()==="en"?"DROP / CLICK":"TRASCINA / CLICCA")}),U("dragenter",e,f=>{f.preventDefault(),p(v,!0)}),U("dragleave",e,f=>{f.preventDefault(),p(v,!1)}),U("dragover",e,f=>f.preventDefault()),U("drop",e,et),K(n,e)},vt=n=>{var e=Nt(),a=_(e);a.__click=st;var u=_(a);$(a);var b=y(a,2),C=_(b),T=_(C);x(T,D=>p(g,D),()=>t(g));var f=y(T,2);{var I=D=>{var ut=Ot();K(D,ut)};Z(f,D=>{t(h)&&D(I)})}$(C);var S=y(C,2),L=_(S),k=_(L),M=_(k),W=_(M);$(M);var O=y(M,2);O.__click=ot,$(k);var R=y(k,2);kt(R),R.__pointerdown=q,R.__input=D=>at(parseInt(D.target.value)),$(L);var N=y(L,2),E=_(N);E.__click=rt;var F=_(E,!0);$(E);var j=y(E,2);j.__click=lt;var dt=_(j,!0);$(j),$(N),$(S),$(b),$(e),Q(()=>{B(u,`← ${l()==="en"?"NEW IMAGE":"NUOVA IMMAGINE"}`),B(W,`${l()==="en"?"BLOCK DENSITY":"DENSITÀ BLOCCHI"}: ${t(A)??""}`),Pt(R,t(A)),B(F,l()==="en"?"EXPORT PNG":"ESPORTA PNG"),B(dt,l()==="en"?"EXPORT SVG":"ESPORTA SVG")}),K(n,e)};Z(it,n=>{t(o)?n(vt,!1):n(ct)})}$(X),K(r,X),$t(),w()}Mt(["click","keydown","change","pointerdown","input"]);export{ne as component,ee as universal};
