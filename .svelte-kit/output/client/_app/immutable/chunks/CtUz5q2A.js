var F=Object.defineProperty;var w=s=>{throw TypeError(s)};var O=(s,e,t)=>e in s?F(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var M=(s,e,t)=>O(s,typeof e!="symbol"?e+"":e,t),D=(s,e,t)=>e.has(s)||w("Cannot "+t);var i=(s,e,t)=>(D(s,e,"read from private field"),t?t.call(s):e.get(s)),d=(s,e,t)=>e.has(s)?w("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),B=(s,e,t,a)=>(D(s,e,"write to private field"),a?a.call(s,t):e.set(s,t),t);import{z as N,N as T,T as y,O as U,f as S,B as x,h as z,m as C,Z as E,D as G,_ as A,G as I,a0 as Z,a1 as $,o as j,a2 as q,a3 as H,a4 as J}from"./BCnZ4NdG.js";var c,h,f,l,p,_,m;class P{constructor(e,t=!0){M(this,"anchor");d(this,c,new Map);d(this,h,new Map);d(this,f,new Map);d(this,l,new Set);d(this,p,!0);d(this,_,()=>{var e=N;if(i(this,c).has(e)){var t=i(this,c).get(e),a=i(this,h).get(t);if(a)T(a),i(this,l).delete(t);else{var n=i(this,f).get(t);n&&(i(this,h).set(t,n.effect),i(this,f).delete(t),n.fragment.lastChild.remove(),this.anchor.before(n.fragment),a=n.effect)}for(const[r,o]of i(this,c)){if(i(this,c).delete(r),r===e)break;const u=i(this,f).get(o);u&&(y(u.effect),i(this,f).delete(o))}for(const[r,o]of i(this,h)){if(r===t||i(this,l).has(r))continue;const u=()=>{if(Array.from(i(this,c).values()).includes(r)){var g=document.createDocumentFragment();E(o,g),g.append(S()),i(this,f).set(r,{effect:o,fragment:g})}else y(o);i(this,l).delete(r),i(this,h).delete(r)};i(this,p)||!a?(i(this,l).add(r),U(o,u,!1)):u()}}});d(this,m,e=>{i(this,c).delete(e);const t=Array.from(i(this,c).values());for(const[a,n]of i(this,f))t.includes(a)||(y(n.effect),i(this,f).delete(a))});this.anchor=e,B(this,p,t)}ensure(e,t){var a=N,n=G();if(t&&!i(this,h).has(e)&&!i(this,f).has(e))if(n){var r=document.createDocumentFragment(),o=S();r.append(o),i(this,f).set(e,{effect:x(()=>t(o)),fragment:r})}else i(this,h).set(e,x(()=>t(this.anchor)));if(i(this,c).set(a,e),n){for(const[u,b]of i(this,h))u===e?a.skipped_effects.delete(b):a.skipped_effects.add(b);for(const[u,b]of i(this,f))u===e?a.skipped_effects.delete(b.effect):a.skipped_effects.add(b.effect);a.oncommit(i(this,_)),a.ondiscard(i(this,m))}else z&&(this.anchor=C),i(this,_).call(this)}}c=new WeakMap,h=new WeakMap,f=new WeakMap,l=new WeakMap,p=new WeakMap,_=new WeakMap,m=new WeakMap;let v=!1,k=Symbol();function Q(s,e,t){const a=t[e]??(t[e]={store:null,source:I(void 0),unsubscribe:A});if(a.store!==s&&!(k in t))if(a.unsubscribe(),a.store=s??null,s==null)a.source.v=void 0,a.unsubscribe=A;else{var n=!0;a.unsubscribe=Z(s,r=>{n?a.source.v=r:H(a.source,r)}),n=!1}return s&&k in t?$(s):j(a.source)}function R(){const s={};function e(){q(()=>{for(var t in s)s[t].unsubscribe();J(s,k,{enumerable:!1,value:!0})})}return[s,e]}function V(s){var e=v;try{return v=!1,[s(),v]}finally{v=e}}export{P as B,Q as a,V as c,R as s};
